#!/usr/bin/env bash
set -e

echo "[Atlas] ğŸ” Running security scan..."

# Run environment check first
bash scripts/check-env.sh

# Primary: Use Gitleaks (industry standard)
if command -v gitleaks >/dev/null 2>&1; then
  echo "[Atlas] âœ… Using Gitleaks (industry standard)"
  gitleaks protect --staged --config .gitleaks.toml
else
  # Fallback: Custom regex scanner
  echo "[Atlas] âš ï¸  Gitleaks not found, falling back to custom scanner"
  echo "[Atlas] ğŸ’¡ Install Gitleaks for better detection: brew install gitleaks"
  bash scripts/pre-commit-security-scan.sh
fi