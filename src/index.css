/* ✅ Mobile optimizations - MUST be first */
@import './features/rituals/styles/mobile.css';
/* ✅ Android optimizations - Material Design & Android-specific fixes */
@import './styles/android-optimizations.css';

@tailwind base;
@tailwind components;
@tailwind utilities;

/* ✅ REMOVED: Duplicate body styling - handled below */

/* ✅ FIX: HTML element - prevent layout jumps */
html {
  background-color: #f9f6f3; /* Light mode default */
  height: 100dvh; /* Fixed height prevents jumps when browser UI changes */
  min-height: 100dvh;
  overflow: hidden; /* Prevent scroll on html element */
  /* ✅ FIX: Prevent Safari bar animation on scroll */
  overscroll-behavior: none;
  overscroll-behavior-y: none;
}

/* ✅ DARK MODE: Override html background for dark mode */
html.dark {
  background-color: #111827 !important; /* gray-900 - !important to override base html rule */
}

/* === Viewport height fix for Safari + Chrome Mobile === */
.vh-100 {
  height: 100dvh;
  min-height: 100dvh;
}

@supports (-webkit-touch-callout: none) {
  .vh-100 {
    height: -webkit-fill-available;
    min-height: -webkit-fill-available;
  }
}

/* ✅ FIX: Body styling - prevent layout jumps */
body {
  height: 100dvh; /* Use dvh consistently */
  min-height: 100dvh;
  max-height: 100dvh; /* Prevent expansion beyond viewport */
  overflow: hidden; /* Prevent body scroll - let app handle scrolling */
  /* ✅ FIX: Allow vertical scrolling on mobile - manipulation blocks scroll */
  touch-action: pan-y pinch-zoom; /* Allow vertical pan (scroll) and pinch zoom */
  width: 100%;
  /* ✅ FIX: Prevent layout shifts from browser UI changes */
  position: relative;
  /* ✅ FIX: Prevent Safari bar animation on scroll */
  overscroll-behavior: none;
  overscroll-behavior-y: none;
}

/* ✅ FIX: Apply touch-action to all interactive elements to prevent preventDefault() warnings */
button,
a,
[role='button'],
input,
textarea,
select {
  touch-action: manipulation;
}

/* Atlas Attachment Menu Styles */
.menu-item {
  @apply flex items-center gap-2 px-3 py-2 w-full text-left rounded-md transition-colors;
  @apply hover:bg-gray-700 hover:text-[#F4E5D9];
}

/* Atlas Image Styles */
.chat-image {
  background-color: transparent !important;
  background: transparent !important;
}

/* Safe area support for mobile devices */
.safe-area-inset-bottom {
  padding-bottom: max(1.5rem, env(safe-area-inset-bottom));
}

.safe-area-inset-top {
  padding-top: max(1rem, env(safe-area-inset-top));
}

/* Ritual pages with bottom navigation */
.safe-bottom-nav {
  padding-bottom: calc(60px + env(safe-area-inset-bottom, 0));
}

/* Touch target standardization */
.touch-target {
  @apply min-h-[48px] min-w-[48px] flex items-center justify-center;
}

/* Better text handling */
.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* ✅ REMOVED: AttachmentMenu CSS (component no longer used - simplified to direct file input) */

/* Optional: remove any inherited transforms from parents that might clip the menu */
[data-input-area],
[data-input-area] * {
  transform: none !important;
}

/* ✅ FIX: Prevent horizontal scroll */
html,
body {
  overflow-x: hidden;
  /* Height handled above with 100dvh */
}

/* ✅ Mobile browser UI handling - now handled dynamically via useBrowserUI hook */

/* Chat input bar styling - now handled by component */
.chat-input-bar {
  display: flex;
  align-items: center;
  padding: 0.5rem;
  background: var(--atlas-pearl); /* Atlas pearl background */
  border-top: 1px solid rgba(151, 134, 113, 0.2); /* Atlas stone border */
}

.chat-input-bar input {
  flex: 1;
  padding: 0.5rem;
  font-size: 16px; /* prevents iOS zoom */
  border-radius: 0.5rem;
  border: none;
  outline: none;
  background: transparent;
  color: white;
}

.chat-input-bar input::placeholder {
  color: rgba(255, 255, 255, 0.6);
}

/* Ensure smooth scrolling for chat messages */
.chat-messages-container {
  padding-bottom: 20px; /* Space for input bar */
  min-height: calc(100vh - 80px);
}

/* Prevent input zoom on iOS */
@media screen and (-webkit-min-device-pixel-ratio: 0) {
  select,
  textarea,
  input[type='text'],
  input[type='password'],
  input[type='datetime'],
  input[type='datetime-local'],
  input[type='date'],
  input[type='month'],
  input[type='time'],
  input[type='week'],
  input[type='number'],
  input[type='email'],
  input[type='url'],
  input[type='search'],
  input[type='tel'],
  input[type='color'] {
    font-size: 16px !important;
  }
}

/* Dark mode adjustments */
.dark .chat-input-bar {
  background: #1a1a1a; /* Dark mode - neutral dark */
  border-top-color: rgba(151, 134, 113, 0.3); /* Atlas stone border */
}

/* Smart scroll system animations */
@keyframes pulse-glow {
  0%,
  100% {
    box-shadow: 0 0 0px rgba(211, 220, 171, 0);
  }
  50% {
    box-shadow: 0 0 10px rgba(211, 220, 171, 0.8);
  }
}

.animate-pulse-glow {
  animation: pulse-glow 1.5s infinite;
}

/* Atlas Color CSS Variables - Complete Theme System */
:root {
  /* Primary Atlas Brand Colors */
  --atlas-brand: #b2bda3;
  --atlas-accent: #f4e5d9;

  /* Core Palette */
  --atlas-sage: #d3dcab;
  --atlas-sand: #cec1b8;
  --atlas-pearl: #f9f6f3;
  --atlas-peach: #f3d3b8;
  --atlas-stone: #978671;

  /* UI Colors */
  --atlas-bg: #f9f6f3;
  --atlas-surface: #ffffff;
  --atlas-border: #e8ddd2;
  --atlas-border-sand: #cec1b8;

  /* Text Colors */
  --atlas-text-dark: #3b3632;
  --atlas-text-medium: #5a524a;
  --atlas-text-muted: #8b7e74;
  --atlas-text-primary: #222222;
  --atlas-text-secondary: #4a4a4a;
  --atlas-text-subtle: #6b7280;

  /* Button Colors */
  --atlas-button: #f0e6dc;
  --atlas-button-hover: #e8ddd2;

  /* Accent Colors */
  --atlas-accent-1: #c8956a;
  --atlas-accent-2: #cf9a96;
  --atlas-accent-3: #a67571;

  /* Gradient Colors */
  --atlas-gradient-start: #b2bda3;
  --atlas-gradient-end: #f4e5d9;

  /* Semantic Colors */
  --atlas-success: #a7c080;
  --atlas-warning: #e8c88e;
  --atlas-error: #d89090;

  /* Tier-Specific Colors */
  --atlas-tier-free: #cec1b8;
  --atlas-tier-core: #d3dcab;
  --atlas-tier-studio: #978671;

  /* Safe Area Insets (mobile notch/navigation) */
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left: env(safe-area-inset-left, 0px);
  --safe-right: env(safe-area-inset-right, 0px);
}

/* ✅ DARK MODE: CSS Variables override for dark mode */
html.dark {
  /* Background Colors */
  --atlas-bg: #111827; /* gray-900 */
  --atlas-surface: #1f2937; /* gray-800 */
  --atlas-pearl: #111827; /* gray-900 */

  /* Border Colors */
  --atlas-border: #374151; /* gray-700 */
  --atlas-border-sand: #4b5563; /* gray-600 */

  /* Text Colors */
  --atlas-text-dark: #f9fafb; /* gray-50 */
  --atlas-text-medium: #e5e7eb; /* gray-200 */
  --atlas-text-muted: #9ca3af; /* gray-400 */
  --atlas-text-primary: #ffffff;
  --atlas-text-secondary: #d1d5db; /* gray-300 */
  --atlas-text-subtle: #9ca3af; /* gray-400 */

  /* Button Colors */
  --atlas-button: #374151; /* gray-700 */
  --atlas-button-hover: #4b5563; /* gray-600 */
}

/* ✅ DARK MODE: Body background for dark mode */
html.dark body {
  background-color: #111827 !important; /* gray-900 - !important to override any conflicting rules */
  color: #f9fafb !important; /* gray-50 */
}

/* ✅ UNIFIED INPUT BAR: No shadows for clean dark mode look */
.unified-input-bar {
  box-shadow: none !important;
}

/* ✅ CRITICAL FIX: Override any blue link colors in chat messages */
/* Comprehensive coverage - target ALL possible link locations with maximum specificity */
.prose a,
.prose-invert a,
[class*="prose"] a,
div[class*="message"] a,
div[class*="Message"] a,
[id^="message-"] a,
[class*="MessageRenderer"] a,
[class*="message-renderer"] a,
main[aria-label*="chat"] a,
main[aria-label*="Chat"] a,
div[role="log"] a,
/* Target links in EnhancedMessageBubble specifically */
div[class*="EnhancedMessageBubble"] a,
div[class*="enhanced-message-bubble"] a,
/* Target links in any chat container */
div[class*="chat"] a,
section[class*="chat"] a,
/* Target links in markdown content */
.markdown a,
[class*="markdown"] a,
/* Target any link with blue color that might slip through */
a[href]:not([class*="button"]):not([class*="btn"]),
/* Nuclear option - target ALL links in prose containers */
.prose a[href],
.prose-invert a[href],
.prose p a,
.prose-invert p a,
.prose li a,
.prose-invert li a,
.prose div a,
.prose-invert div a {
  color: #b2bda3 !important; /* Atlas sage green - override ANY blue */
  text-decoration: underline !important;
  text-decoration-color: #b2bda3 !important;
  -webkit-text-decoration-color: #b2bda3 !important;
}

/* Force override visited and active link colors */
.prose a:visited,
.prose-invert a:visited,
[class*='prose'] a:visited,
.prose a[href]:visited,
.prose-invert a[href]:visited {
  color: #b2bda3 !important;
}

.prose a:active,
.prose-invert a:active,
[class*='prose'] a:active,
.prose a[href]:active,
.prose-invert a[href]:active {
  color: #a3b295 !important;
}

.prose a:hover,
.prose-invert a:hover,
[class*='prose'] a:hover,
div[class*='message'] a:hover,
div[class*='Message'] a:hover,
[id^='message-'] a:hover,
[class*='MessageRenderer'] a:hover,
[class*='message-renderer'] a:hover,
main[aria-label*='chat'] a:hover,
main[aria-label*='Chat'] a:hover,
div[role='log'] a:hover,
div[class*='EnhancedMessageBubble'] a:hover,
div[class*='enhanced-message-bubble'] a:hover,
div[class*='chat'] a:hover,
section[class*='chat'] a:hover,
.markdown a:hover,
[class*='markdown'] a:hover,
a[href]:not([class*='button']):not([class*='btn']):hover {
  color: #a3b295 !important; /* Darker sage on hover */
  text-decoration: underline !important;
}

/* ✅ Additional fix: Override Tailwind's default prose link colors */
.prose a:not([class*='button']):not([class*='btn']) {
  color: #b2bda3 !important;
}

.prose-invert a:not([class*='button']):not([class*='btn']) {
  color: #b2bda3 !important;
}

/* ✅ NUCLEAR OPTION: Target ALL links everywhere in the app with maximum specificity */
/* This must be at the END of the CSS file to ensure it loads last */
html body .prose a,
html body .prose-invert a,
html body [class*='prose'] a,
html body div[class*='message'] a,
html body div[class*='Message'] a,
html body [id^='message-'] a,
html body [class*='MessageRenderer'] a,
html body [class*='message-renderer'] a,
html body main[aria-label*='chat'] a,
html body main[aria-label*='Chat'] a,
html body div[role='log'] a,
html body div[class*='EnhancedMessageBubble'] a,
html body div[class*='enhanced-message-bubble'] a,
html body div[class*='chat'] a,
html body section[class*='chat'] a,
html body .markdown a,
html body [class*='markdown'] a,
html
  body
  a[href]:not([class*='button']):not([class*='btn']):not([class*='nav']):not([class*='menu']) {
  color: #b2bda3 !important;
  text-decoration-color: #b2bda3 !important;
  -webkit-text-decoration-color: #b2bda3 !important;
}

html body .prose a:visited,
html body .prose-invert a:visited,
html body [class*='prose'] a:visited {
  color: #b2bda3 !important;
}

html body .prose a:hover,
html body .prose-invert a:hover,
html body [class*='prose'] a:hover {
  color: #a3b295 !important;
  text-decoration-color: #a3b295 !important;
  -webkit-text-decoration-color: #a3b295 !important;
}

/* ✅ CRITICAL: Force black text for maximum legibility - LIGHT MODE ONLY */
html:not(.dark) body div[class*='EnhancedMessageBubble'] div[style*='color'] {
  color: #000000 !important;
}

html:not(.dark) body div[class*='message'] div[style*='color'] {
  color: #000000 !important;
}

html:not(.dark) body .prose p,
html:not(.dark) body .prose h1,
html:not(.dark) body .prose h2,
html:not(.dark) body .prose h3,
html:not(.dark) body .prose ul,
html:not(.dark) body .prose ol,
html:not(.dark) body .prose li,
html:not(.dark) body .prose strong,
html:not(.dark) body .prose blockquote,
html:not(.dark) body .prose em {
  color: #000000 !important;
}

/* ✅ CRITICAL: Override ANY blue colors in header and footer */
header a,
footer a,
[class*='header'] a,
[class*='Header'] a,
[class*='footer'] a,
[class*='Footer'] a,
nav a,
[class*='nav'] a,
[class*='Nav'] a,
button[class*='header'],
button[class*='Header'],
div[class*='header'] button,
div[class*='Header'] button {
  color: inherit !important;
}

/* ✅ REMOVED: Glassmorphism effects - using clean white header and transparent footer */
/* No backdrop-filter or blur effects to prevent any blue tint */

/* ✅ Prevent any blue links/buttons in header/footer */
div[class*='backdrop-blur-xl'][class*='sticky'][class*='top-0'] a,
div[class*='backdrop-blur-xl'][class*='sticky'][class*='top-0'] button,
div[class*='fixed'][class*='bottom'][class*='z-30'] a,
div[class*='fixed'][class*='bottom'][class*='z-30'] button {
  color: inherit !important;
}

/* ✅ Override any blue backgrounds - LIGHT MODE ONLY */
html:not(.dark) .bg-blue-50,
html:not(.dark) .bg-blue-100,
html:not(.dark) .bg-blue-200,
html:not(.dark) .bg-blue-300,
html:not(.dark) .bg-blue-400,
html:not(.dark) .bg-blue-500,
html:not(.dark) .bg-blue-600,
html:not(.dark) .bg-blue-700,
html:not(.dark) .bg-blue-800,
html:not(.dark) .bg-blue-900,
html:not(.dark) [class*='bg-blue'] {
  background-color: white !important;
  background: white !important;
}

/* ✅ TEXT SELECTION: Make highlighted text visible with Atlas colors */
::selection {
  background-color: #d3dcab; /* Atlas sage - light green background */
  color: #3b3632; /* Dark text for contrast */
  -webkit-text-fill-color: #3b3632;
}

::-moz-selection {
  background-color: #d3dcab; /* Atlas sage - light green background */
  color: #3b3632; /* Dark text for contrast */
}

/* ✅ Ensure selection is visible in chat messages */
.prose ::selection,
.prose-invert ::selection,
[class*='message'] ::selection,
[class*='Message'] ::selection,
div[class*='EnhancedMessageBubble'] ::selection {
  background-color: #d3dcab !important; /* Atlas sage */
  color: #3b3632 !important; /* Dark text */
  -webkit-text-fill-color: #3b3632 !important;
}

.prose ::-moz-selection,
.prose-invert ::-moz-selection,
[class*='message'] ::-moz-selection,
[class*='Message'] ::-moz-selection,
div[class*='EnhancedMessageBubble'] ::-moz-selection {
  background-color: #d3dcab !important; /* Atlas sage */
  color: #3b3632 !important; /* Dark text */
}

/* ✅ CRITICAL: Modal portal root styling to ensure proper z-index stacking */
#modal-portal-root {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  z-index: 9999999;
  isolation: isolate;
}

#modal-portal-root > * {
  pointer-events: auto;
}

/* ✅ Atlas Scrollbar Styling - Light & Dark Mode */
/* Webkit browsers (Chrome, Safari, Edge) */
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

/* Light mode: Subtle scrollbar matching background */
::-webkit-scrollbar-track {
  background: var(--atlas-pearl); /* Light mode: #f9f6f3 - matches background */
  border-radius: 5px;
}

::-webkit-scrollbar-thumb {
  background: var(--atlas-pearl); /* Light mode: Same as background - invisible */
  border-radius: 5px;
  border: 2px solid var(--atlas-pearl);
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(151, 134, 113, 0.2); /* Light mode: Very subtle stone on hover */
}

/* Dark mode scrollbar */
html.dark ::-webkit-scrollbar-track {
  background: #1f2937; /* gray-800 */
}

html.dark ::-webkit-scrollbar-thumb {
  background: #4b5563; /* gray-600 */
  border-color: #1f2937;
}

html.dark ::-webkit-scrollbar-thumb:hover {
  background: #6b7280; /* gray-500 */
}

/* Firefox - Light mode: Subtle matching background */
* {
  scrollbar-width: thin;
  scrollbar-color: var(--atlas-pearl) var(--atlas-pearl); /* Same color = invisible */
}

html.dark * {
  scrollbar-color: #4b5563 #1f2937; /* gray-600 gray-800 */
}
