name: Test Slack Success Alert

on:
  workflow_dispatch:

jobs:
  slack-success-test:
    runs-on: ubuntu-latest
    steps:
      - name: Send success Slack alert via proxy
        env:
          ALERT_PROXY_URL: ${{ secrets.ALERT_PROXY_URL }}
          ALERT_TOKEN: ${{ secrets.CICD_ALERT_TOKEN }}
        run: |
          curl -X POST -H "Content-type: application/json" \
               -H "Authorization: Bearer $ALERT_TOKEN" \
               --data "{
                 \"attachments\": [
                   {
                     \"color\": \"#36a64f\",
                     \"title\": \"✅ Atlas CICD Success Test\",
                     \"text\": \"Alert proxy is working! This is a SUCCESS message via Supabase Edge Function.\",
                     \"footer\": \"GitHub Actions • Atlas Security • Alert Proxy\",
                     \"ts\": $(date +%s)
                   }
                 ]
               }" \
               $ALERT_PROXY_URL
